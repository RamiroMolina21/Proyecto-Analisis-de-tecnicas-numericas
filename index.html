<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador de Ajuste de Curvas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white; 
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            resize: vertical;
            min-height: 100px;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .method-select {
            margin-bottom: 20px;
        }

        .method-select label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .method-select select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
        }

        .method-checkboxes {
            margin-bottom: 20px;
        }

        .method-checkboxes label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none;
                box-shadow: none;
            }
            
            .btn:active {
                transform: scale(0.98);
                box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            }
        }

        .chart-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            position: relative;
            height: 400px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .chart-section canvas {
            max-height: 100%;
            width: 100% !important;
            height: auto !important;
        }

        .results {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .results h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-item {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .result-item strong {
            color: #333;
        }

        .error {
            color: #e74c3c;
            padding: 10px;
            background: #fadbd8;
            border-radius: 5px;
            margin-top: 10px;
        }

        .comparison-charts {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .methods-info {
            line-height: 1.6;
        }

        .method-info {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .method-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .about-section {
            line-height: 1.6;
        }

        .about-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .about-section p {
            margin-bottom: 15px;
        }

        .team-member {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* Tablet and Desktop Responsive */
        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
                margin-bottom: 8px;
                line-height: 1.2;
            }

            .header p {
                font-size: 0.9em;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                padding: 12px 15px;
                font-size: 0.9em;
                flex: 1;
                min-width: 120px;
                text-align: center;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .content {
                padding: 0;
                gap: 15px;
            }

            .input-section {
                padding: 15px;
                border-radius: 12px;
            }

            .input-group {
                margin-bottom: 15px;
            }

            .input-group label {
                font-size: 0.95em;
                margin-bottom: 6px;
            }

            .input-group textarea {
                padding: 10px;
                font-size: 0.9em;
                min-height: 80px;
                border-radius: 6px;
            }

            .method-select {
                margin-bottom: 15px;
            }

            .method-select label {
                font-size: 0.95em;
                margin-bottom: 6px;
            }

            .method-select select {
                padding: 10px;
                font-size: 0.9em;
                border-radius: 6px;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
                max-height: 150px;
            }

            .btn {
                padding: 12px;
                font-size: 1em;
                border-radius: 6px;
            }

            .chart-section {
                padding: 15px;
                border-radius: 12px;
                height: 350px;
                min-height: 300px;
            }

            .results {
                margin-top: 15px;
                padding: 15px;
                border-radius: 8px;
            }

            .results h3 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }

            .result-item {
                margin: 8px 0;
                padding: 8px;
                font-size: 0.9em;
            }

            .error {
                padding: 8px;
                font-size: 0.9em;
                margin-top: 8px;
            }
        }

        /* Small Mobile Devices */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.5em;
                margin-bottom: 6px;
            }

            .header p {
                font-size: 0.85em;
            }

            .tab {
                padding: 10px 12px;
                font-size: 0.85em;
            }

            .tab-content {
                padding: 15px 10px;
            }

            .input-section {
                padding: 12px;
            }

            .input-group {
                margin-bottom: 12px;
            }

            .input-group textarea {
                padding: 8px;
                font-size: 0.85em;
                min-height: 70px;
            }

            .method-select select {
                padding: 8px;
                font-size: 0.85em;
            }

            .btn {
                padding: 10px;
                font-size: 0.95em;
            }

            .chart-section {
                padding: 12px;
                height: 300px;
                min-height: 250px;
            }

            .results {
                padding: 12px;
            }

            .result-item {
                margin: 6px 0;
                padding: 6px;
                font-size: 0.85em;
            }
        }

        /* Extra Small Devices */
        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.3em;
            }

            .input-group textarea {
                min-height: 60px;
                font-size: 0.8em;
            }

            .method-select select {
                font-size: 0.8em;
            }

            .btn {
                font-size: 0.9em;
            }

            .chart-section {
                height: 280px;
                min-height: 250px;
                padding: 10px;
            }
        }

        /* Chart specific mobile improvements */
        @media (max-width: 768px) {
            .chart-section {
                margin-bottom: 20px;
            }
            
            .chart-section canvas {
                touch-action: manipulation;
            }
        }

        /* Landscape mobile orientation */
        @media (max-width: 768px) and (orientation: landscape) {
            .chart-section {
                height: 250px;
                min-height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Evaluador de Ajuste de Curvas</h1>
            <p>An√°lisis avanzado con 10 m√©todos de regresi√≥n</p>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="calculator">Calculadora</div>
            <div class="tab" data-tab="methods">M√©todos</div>
            <div class="tab" data-tab="about">Integrantes</div>
        </div>

        <!-- Pesta√±a de Calculadora -->
        <div class="tab-content active" id="calculator">
            <div class="content">
                <div class="input-section">
                    <div class="input-group">
                        <label>Valores de X (separados por comas):</label>
                        <textarea id="xValues" placeholder="Ejemplo: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10">1, 2, 3, 4, 5, 6, 7, 8, 9, 10</textarea>
                    </div>

                    <div class="input-group">
                        <label>Valores de Y (separados por comas):</label>
                        <textarea id="yValues" placeholder="Ejemplo: 2.1, 4.3, 6.2, 8.5, 10.1, 12.3, 14.8, 16.5, 18.9, 20.5">2.1, 4.3, 6.2, 8.5, 10.1, 12.3, 14.8, 15.5, 18.9, 36.5</textarea>
                    </div>

                    <div class="method-select">
                        <label>M√©todo de Ajuste (Individual):</label>
                        <select id="methodSelect">
                            <option value="linear">Ajuste Lineal</option>
                            <option value="exponential">Exponencial</option>
                            <option value="geometric">Geom√©trica</option>
                            <option value="hyperbolic">Hiperb√≥lica</option>
                            <option value="polynomial2">Polin√≥mica (Grado 2)</option>
                            <option value="polynomial3">Polin√≥mica (Grado 3)</option>
                            <option value="polynomial4">Polin√≥mica (Grado 4)</option>
                            <option value="movingAverage">Media M√≥vil</option>
                            <option value="expAsymptotic">Exponencial Asint√≥tico</option>
                            <option value="logistic">Log√≠stico</option>
                            <option value="logarithmic">Logar√≠tmico</option>
                            <option value="power">Potencial</option>
                        </select>
                    </div>

                    <div class="method-checkboxes">
                        <label>Comparar M√∫ltiples M√©todos:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="linearCheck" value="linear">
                                <label for="linearCheck">Lineal</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="exponentialCheck" value="exponential">
                                <label for="exponentialCheck">Exponencial</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="geometricCheck" value="geometric">
                                <label for="geometricCheck">Geom√©trica</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="hyperbolicCheck" value="hyperbolic" checked>
                                <label for="hyperbolicCheck">Hiperb√≥lica</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="polynomial2Check" value="polynomial2" checked>
                                <label for="polynomial2Check">Polin√≥mica (Grado 2)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="polynomial3Check" value="polynomial3" checked>
                                <label for="polynomial3Check">Polin√≥mica (Grado 3)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="logisticCheck" value="logistic" checked>
                                <label for="logisticCheck">Log√≠stico</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="logarithmicCheck" value="logarithmic" checked>
                                <label for="logarithmicCheck">Logar√≠tmico</label>
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="calculateFit()">Calcular Ajuste</button>

                    <div id="results"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-section">
                        <canvas id="chart"></canvas>
                    </div>
                    
                    <div id="comparisonCharts" class="comparison-charts">
                        <!-- Aqu√≠ se agregar√°n las gr√°ficas de comparaci√≥n y errores -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Pesta√±a de M√©todos -->
        <div class="tab-content" id="methods">
            <div class="methods-info">
                <h2>M√©todos de Ajuste de Curvas</h2>
                
                <div class="method-info">
                    <h3>Ajuste Lineal</h3>
                    <p>Modela la relaci√≥n entre dos variables mediante una l√≠nea recta. Es el m√©todo m√°s simple y se utiliza cuando la relaci√≥n entre las variables es aproximadamente lineal.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = mx + b</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Exponencial</h3>
                    <p>Se utiliza cuando los datos muestran un crecimiento o decrecimiento exponencial. La variable dependiente cambia a una tasa proporcional a su valor actual.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a * e^(bx)</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Geom√©trico</h3>
                    <p>Tambi√©n conocido como ajuste de potencia, se utiliza cuando la relaci√≥n entre variables puede describirse mediante una funci√≥n de potencia.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a * x^b</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Hiperb√≥lico</h3>
                    <p>Se aplica cuando la relaci√≥n entre variables es inversamente proporcional. √ötil para modelar fen√≥menos donde el efecto disminuye con el aumento de la variable independiente.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a + b/x</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Polin√≥mico</h3>
                    <p>Modela relaciones no lineales mediante polinomios de diferentes grados. Permite capturar curvaturas m√°s complejas en los datos.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a‚ÇÄ + a‚ÇÅx + a‚ÇÇx¬≤ + ... + a‚Çôx‚Åø</p>
                </div>
                
                <div class="method-info">
                    <h3>Media M√≥vil</h3>
                    <p>Suaviza las fluctuaciones a corto plazo en los datos, destacando tendencias a largo plazo. Es √∫til para an√°lisis de series temporales.</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Exponencial Asint√≥tico</h3>
                    <p>Modela crecimiento que se acerca a un valor l√≠mite (as√≠ntota). √ötil para fen√≥menos con crecimiento limitado.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a - b * e^(-cx)</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Log√≠stico</h3>
                    <p>Describe crecimiento que es inicialmente exponencial, luego se desacelera y finalmente se estabiliza. Com√∫n en modelos de poblaci√≥n y difusi√≥n.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = L / (1 + e^(-k(x-x‚ÇÄ)))</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Logar√≠tmico</h3>
                    <p>Se utiliza cuando la tasa de cambio de la variable dependiente disminuye a medida que aumenta la variable independiente.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a * ln(x) + b</p>
                </div>
                
                <div class="method-info">
                    <h3>Ajuste Potencial</h3>
                    <p>Similar al ajuste geom√©trico, modela relaciones donde una variable es proporcional a una potencia de la otra.</p>
                    <p><strong>Ecuaci√≥n:</strong> y = a * x^b</p>
                </div>
            </div>
        </div>

        <!-- Pesta√±a Acerca de -->
        <div class="tab-content" id="about">
            <div class="about-section">
                <h2>Acerca de este Proyecto</h2>
                
                <div class="team-member">
                    <h3>Integrantes del Equipo</h3>
                    <p></strong> Ramiro Ernesto Molina Acosta</p>
                    <p></strong> Johan Benitez Yaruro</p>
                    <p></strong> Jesus Berdugo Fajardo</p>
                    <!-- Agrega m√°s nombres seg√∫n sea necesario -->
                </div>
                
                <div class="team-member">
                    <h3>Asignatura</h3>
                    <p>Analisis de Tecnicas Numericas</p>
                </div>
                
                <div class="team-member">
                    <h3>Facultad</h3>
                    <p>Ciencias B√°sicas, Ingenier√≠as y Arquitectura</p>
                    <p>Corporaci√≥n Universitaria del Caribe (CECAR)</p>
                </div>
                
                <div class="team-member">
                    <h3>Descripci√≥n del Proyecto</h3>
                    <p>Esta aplicaci√≥n web permite realizar ajustes de curvas utilizando diferentes m√©todos de regresi√≥n. Los usuarios pueden ingresar sus datos y comparar visualmente la efectividad de diferentes modelos para encontrar el que mejor se ajuste a sus datos.</p>
                    <p>La herramienta incluye m√©tricas de evaluaci√≥n como R¬≤, MSE, RMSE y MAE para ayudar en la selecci√≥n del modelo m√°s adecuado.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        let comparisonChart = null;
        let errorChart = null;
        const methodColors = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
            '#9966FF', '#FF9F40', '#8AC926', '#1982C4',
            '#6A4C93', '#F15BB5', '#00BBF9', '#00F5D4'
        ];

        // Sistema de pesta√±as
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remover clase activa de todas las pesta√±as
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Agregar clase activa a la pesta√±a clickeada
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        function parseInput(input) {
            return input.split(',').map(v => parseFloat(v.trim())).filter(v => !isNaN(v));
        }

        function linearRegression(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((acc, xi, i) => acc + xi * y[i], 0);
            const sumX2 = x.reduce((acc, xi) => acc + xi * xi, 0);

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            return { slope, intercept, equation: `y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}` };
        }

        function exponentialFit(x, y) {
            const lnY = y.map(yi => Math.log(yi));
            const { slope, intercept } = linearRegression(x, lnY);
            const a = Math.exp(intercept);
            const b = slope;
            return { a, b, equation: `y = ${a.toFixed(4)} * e^(${b.toFixed(4)}x)` };
        }

        function geometricFit(x, y) {
            const lnX = x.map(xi => Math.log(xi));
            const lnY = y.map(yi => Math.log(yi));
            const { slope, intercept } = linearRegression(lnX, lnY);
            const a = Math.exp(intercept);
            const b = slope;
            return { a, b, equation: `y = ${a.toFixed(4)} * x^${b.toFixed(4)}` };
        }

        function hyperbolicFit(x, y) {
            const invX = x.map(xi => 1 / xi);
            const { slope, intercept } = linearRegression(invX, y);
            return { a: intercept, b: slope, equation: `y = ${intercept.toFixed(4)} + ${slope.toFixed(4)}/x` };
        }

        function polynomialRegression(x, y, degree) {
            const n = x.length;
            const X = [];
            for (let i = 0; i < n; i++) {
                X[i] = [];
                for (let j = 0; j <= degree; j++) {
                    X[i][j] = Math.pow(x[i], j);
                }
            }

            const XT = transpose(X);
            const XTX = multiply(XT, X);
            const XTY = multiply(XT, y.map(yi => [yi]));
            const coeffs = gaussianElimination(XTX, XTY);

            let equation = 'y = ';
            for (let i = coeffs.length - 1; i >= 0; i--) {
                if (i === coeffs.length - 1) {
                    equation += `${coeffs[i].toFixed(4)}x^${i}`;
                } else if (i === 0) {
                    equation += ` + ${coeffs[i].toFixed(4)}`;
                } else {
                    equation += ` + ${coeffs[i].toFixed(4)}x^${i}`;
                }
            }

            return { coeffs, equation };
        }

        function transpose(matrix) {
            return matrix[0].map((_, i) => matrix.map(row => row[i]));
        }

        function multiply(a, b) {
            const result = [];
            for (let i = 0; i < a.length; i++) {
                result[i] = [];
                for (let j = 0; j < b[0].length; j++) {
                    let sum = 0;
                    for (let k = 0; k < a[0].length; k++) {
                        sum += a[i][k] * b[k][j];
                    }
                    result[i][j] = sum;
                }
            }
            return result;
        }

        function gaussianElimination(A, B) {
            const n = A.length;
            const aug = A.map((row, i) => [...row, B[i][0]]);

            for (let i = 0; i < n; i++) {
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(aug[k][i]) > Math.abs(aug[maxRow][i])) {
                        maxRow = k;
                    }
                }
                [aug[i], aug[maxRow]] = [aug[maxRow], aug[i]];

                for (let k = i + 1; k < n; k++) {
                    const factor = aug[k][i] / aug[i][i];
                    for (let j = i; j <= n; j++) {
                        aug[k][j] -= factor * aug[i][j];
                    }
                }
            }

            const x = new Array(n);
            for (let i = n - 1; i >= 0; i--) {
                x[i] = aug[i][n];
                for (let j = i + 1; j < n; j++) {
                    x[i] -= aug[i][j] * x[j];
                }
                x[i] /= aug[i][i];
            }
            return x;
        }

        function movingAverage(x, y, window = 3) {
            const result = [];
            for (let i = 0; i < y.length; i++) {
                const start = Math.max(0, i - Math.floor(window / 2));
                const end = Math.min(y.length, i + Math.ceil(window / 2));
                const sum = y.slice(start, end).reduce((a, b) => a + b, 0);
                result.push(sum / (end - start));
            }
            return { values: result, equation: `Media m√≥vil (ventana ${window})` };
        }

        function expAsymptoticFit(x, y) {
            const yMax = Math.max(...y);
            const transformed = y.map(yi => Math.log(yMax - yi));
            const { slope, intercept } = linearRegression(x, transformed);
            const a = yMax;
            const b = Math.exp(intercept);
            const c = -slope;
            return { a, b, c, equation: `y = ${a.toFixed(4)} - ${b.toFixed(4)} * e^(-${c.toFixed(4)}x)` };
        }

        function logisticFit(x, y) {
            const L = Math.max(...y) * 1.1;
            const transformed = y.map(yi => Math.log((L - yi) / yi));
            const { slope, intercept } = linearRegression(x, transformed);
            const k = -slope;
            const x0 = intercept / slope;
            return { L, k, x0, equation: `y = ${L.toFixed(4)} / (1 + e^(-${k.toFixed(4)}(x-${x0.toFixed(4)})))` };
        }

        function logarithmicFit(x, y) {
            const lnX = x.map(xi => Math.log(xi));
            const { slope, intercept } = linearRegression(lnX, y);
            return { a: slope, b: intercept, equation: `y = ${slope.toFixed(4)} * ln(x) + ${intercept.toFixed(4)}` };
        }

        function powerFit(x, y) {
            return geometricFit(x, y);
        }

        function calculateR2(yActual, yPredicted) {
            const yMean = yActual.reduce((a, b) => a + b, 0) / yActual.length;
            const ssTotal = yActual.reduce((acc, yi) => acc + Math.pow(yi - yMean, 2), 0);
            const ssRes = yActual.reduce((acc, yi, i) => acc + Math.pow(yi - yPredicted[i], 2), 0);
            return 1 - (ssRes / ssTotal);
        }

        function predictValues(x, params, method) {
            return x.map(xi => {
                switch (method) {
                    case 'linear':
                        return params.slope * xi + params.intercept;
                    case 'exponential':
                        return params.a * Math.exp(params.b * xi);
                    case 'geometric':
                    case 'power':
                        return params.a * Math.pow(xi, params.b);
                    case 'hyperbolic':
                        return params.a + params.b / xi;
                    case 'polynomial2':
                    case 'polynomial3':
                    case 'polynomial4':
                        return params.coeffs.reduce((acc, c, i) => acc + c * Math.pow(xi, i), 0);
                    case 'expAsymptotic':
                        return params.a - params.b * Math.exp(-params.c * xi);
                    case 'logistic':
                        return params.L / (1 + Math.exp(-params.k * (xi - params.x0)));
                    case 'logarithmic':
                        return params.a * Math.log(xi) + params.b;
                    default:
                        return 0;
                }
            });
        }

        function getMethodName(method) {
            const names = {
                'linear': 'Lineal',
                'exponential': 'Exponencial',
                'geometric': 'Geom√©trica',
                'hyperbolic': 'Hiperb√≥lica',
                'polynomial2': 'Polin√≥mica (Grado 2)',
                'polynomial3': 'Polin√≥mica (Grado 3)',
                'polynomial4': 'Polin√≥mica (Grado 4)',
                'movingAverage': 'Media M√≥vil',
                'expAsymptotic': 'Exponencial Asint√≥tico',
                'logistic': 'Log√≠stico',
                'logarithmic': 'Logar√≠tmico',
                'power': 'Potencial'
            };
            return names[method] || method;
        }

        function calculateFit() {
            const xInput = document.getElementById('xValues').value;
            const yInput = document.getElementById('yValues').value;
            const method = document.getElementById('methodSelect').value;

            const x = parseInput(xInput);
            const y = parseInput(yInput);

            const resultsDiv = document.getElementById('results');

            if (x.length === 0 || y.length === 0 || x.length !== y.length) {
                resultsDiv.innerHTML = '<div class="error">Error: Aseg√∫rate de ingresar datos v√°lidos y que ambas listas tengan la misma longitud.</div>';
                return;
            }

            // Obtener m√©todos seleccionados para comparaci√≥n
            const selectedMethods = [];
            document.querySelectorAll('.checkbox-group input:checked').forEach(checkbox => {
                selectedMethods.push(checkbox.value);
            });

            let params, yPredicted;

            try {
                // Calcular ajuste individual
                switch (method) {
                    case 'linear':
                        params = linearRegression(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'exponential':
                        params = exponentialFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'geometric':
                        params = geometricFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'hyperbolic':
                        params = hyperbolicFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'polynomial2':
                        params = polynomialRegression(x, y, 2);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'polynomial3':
                        params = polynomialRegression(x, y, 3);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'polynomial4':
                        params = polynomialRegression(x, y, 4);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'movingAverage':
                        params = movingAverage(x, y);
                        yPredicted = params.values;
                        break;
                    case 'expAsymptotic':
                        params = expAsymptoticFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'logistic':
                        params = logisticFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'logarithmic':
                        params = logarithmicFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                    case 'power':
                        params = powerFit(x, y);
                        yPredicted = predictValues(x, params, method);
                        break;
                }

                const r2 = calculateR2(y, yPredicted);
                
                // Calcular errores
                const errors = y.map((yi, i) => yi - yPredicted[i]);
                const mse = errors.reduce((acc, e) => acc + e * e, 0) / errors.length;
                const rmse = Math.sqrt(mse);
                const mae = errors.reduce((acc, e) => acc + Math.abs(e), 0) / errors.length;
                const maxError = Math.max(...errors.map(Math.abs));
                const minError = Math.min(...errors.map(Math.abs));

                resultsDiv.innerHTML = `
                    <div class="results">
                        <h3>Resultados del Ajuste</h3>
                        <div class="result-item">
                            <strong>Ecuaci√≥n:</strong> ${params.equation}
                        </div>
                        <div class="result-item">
                            <strong>R¬≤ (Coeficiente de Determinaci√≥n):</strong> ${r2.toFixed(6)}
                        </div>
                        <div class="result-item">
                            <strong>Calidad del Ajuste:</strong> ${r2 > 0.9 ? 'Excelente' : r2 > 0.7 ? 'Bueno' : r2 > 0.5 ? 'Moderado' : 'Bajo'}
                        </div>
                        <div class="result-item">
                            <strong>MSE (Error Cuadr√°tico Medio):</strong> ${mse.toFixed(6)}
                        </div>
                        <div class="result-item">
                            <strong>RMSE (Ra√≠z del Error Cuadr√°tico Medio):</strong> ${rmse.toFixed(6)}
                        </div>
                        <div class="result-item">
                            <strong>MAE (Error Absoluto Medio):</strong> ${mae.toFixed(6)}
                        </div>
                        <div class="result-item">
                            <strong>Error M√°ximo:</strong> ${maxError.toFixed(6)}
                        </div>
                        <div class="result-item">
                            <strong>Error M√≠nimo:</strong> ${minError.toFixed(6)}
                        </div>
                    </div>
                `;

                drawChart(x, y, yPredicted, method);
                
                // Si hay m√©todos seleccionados para comparaci√≥n
                if (selectedMethods.length > 0) {
                    drawComparisonCharts(x, y, selectedMethods);
                } else {
                    // Limpiar gr√°ficas de comparaci√≥n si no hay m√©todos seleccionados
                    document.getElementById('comparisonCharts').innerHTML = '';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error al calcular el ajuste: ${error.message}</div>`;
            }
        }

        function drawChart(x, y, yPredicted, method) {
            const ctx = document.getElementById('chart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Datos Originales',
                        data: x.map((xi, i) => ({ x: xi, y: y[i] })),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        pointRadius: 6
                    }, {
                        label: 'Curva Ajustada',
                        data: x.map((xi, i) => ({ x: xi, y: yPredicted[i] })),
                        type: 'line',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: window.innerWidth < 768 ? 1.2 : 2,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Ajuste de Curva - ' + getMethodName(method),
                            font: { 
                                size: window.innerWidth < 768 ? 12 : 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'center',
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 12
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1,
                            cornerRadius: 6,
                            displayColors: true,
                            titleFont: {
                                size: window.innerWidth < 768 ? 10 : 12
                            },
                            bodyFont: {
                                size: window.innerWidth < 768 ? 9 : 11
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'X', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 6 : 10
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Y', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 5 : 8
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }

        function drawComparisonCharts(x, y, methods) {
            const comparisonChartsDiv = document.getElementById('comparisonCharts');
            
            // Limpiar gr√°ficas anteriores
            comparisonChartsDiv.innerHTML = '';
            
            // Crear contenedores para las nuevas gr√°ficas
            const comparisonChartContainer = document.createElement('div');
            comparisonChartContainer.className = 'chart-section';
            comparisonChartContainer.innerHTML = '<canvas id="comparisonChart"></canvas>';
            
            const errorChartContainer = document.createElement('div');
            errorChartContainer.className = 'chart-section';
            errorChartContainer.innerHTML = '<canvas id="errorChart"></canvas>';
            
            comparisonChartsDiv.appendChild(comparisonChartContainer);
            comparisonChartsDiv.appendChild(errorChartContainer);
            
            // Dibujar gr√°ficas
            drawComparisonChart(x, y, methods);
            drawErrorChart(x, y, methods);
        }

        function drawComparisonChart(x, y, methods) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');

            if (comparisonChart) {
                comparisonChart.destroy();
            }

            const datasets = [{
                label: 'Datos Originales',
                data: x.map((xi, i) => ({ x: xi, y: y[i] })),
                backgroundColor: 'rgba(102, 126, 234, 0.6)',
                borderColor: 'rgba(102, 126, 234, 1)',
                pointRadius: 6
            }];

            methods.forEach((method, index) => {
                let params, yPredicted;
                
                try {
                    switch (method) {
                        case 'linear':
                            params = linearRegression(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'exponential':
                            params = exponentialFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'geometric':
                            params = geometricFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'hyperbolic':
                            params = hyperbolicFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'polynomial2':
                            params = polynomialRegression(x, y, 2);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'polynomial3':
                            params = polynomialRegression(x, y, 3);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'logistic':
                            params = logisticFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'logarithmic':
                            params = logarithmicFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                    }

                    datasets.push({
                        label: getMethodName(method),
                        data: x.map((xi, i) => ({ x: xi, y: yPredicted[i] })),
                        type: 'line',
                        borderColor: methodColors[index % methodColors.length],
                        backgroundColor: methodColors[index % methodColors.length] + '20',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    });
                } catch (error) {
                    console.error(`Error al calcular ${method}:`, error);
                }
            });

            comparisonChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: window.innerWidth < 768 ? 1.2 : 2,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparaci√≥n de M√©todos',
                            font: { 
                                size: window.innerWidth < 768 ? 12 : 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'center',
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 12
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1,
                            cornerRadius: 6,
                            displayColors: true,
                            titleFont: {
                                size: window.innerWidth < 768 ? 10 : 12
                            },
                            bodyFont: {
                                size: window.innerWidth < 768 ? 9 : 11
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'X', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 6 : 10
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Y', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 5 : 8
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }

        function drawErrorChart(x, y, methods) {
            const ctx = document.getElementById('errorChart').getContext('2d');

            if (errorChart) {
                errorChart.destroy();
            }

            const datasets = [];

            methods.forEach((method, index) => {
                let params, yPredicted;
                
                try {
                    switch (method) {
                        case 'linear':
                            params = linearRegression(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'exponential':
                            params = exponentialFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'geometric':
                            params = geometricFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'hyperbolic':
                            params = hyperbolicFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'polynomial2':
                            params = polynomialRegression(x, y, 2);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'polynomial3':
                            params = polynomialRegression(x, y, 3);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'logistic':
                            params = logisticFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                        case 'logarithmic':
                            params = logarithmicFit(x, y);
                            yPredicted = predictValues(x, params, method);
                            break;
                    }

                    const errors = y.map((yi, i) => Math.abs(yi - yPredicted[i]));
                    
                    datasets.push({
                        label: getMethodName(method),
                        data: x.map((xi, i) => ({ x: xi, y: errors[i] })),
                        type: 'line',
                        borderColor: methodColors[index % methodColors.length],
                        backgroundColor: methodColors[index % methodColors.length] + '20',
                        borderWidth: 2,
                        pointRadius: 3,
                        tension: 0.4
                    });
                } catch (error) {
                    console.error(`Error al calcular ${method}:`, error);
                }
            });

            errorChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: window.innerWidth < 768 ? 1.2 : 2,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Errores por M√©todo',
                            font: { 
                                size: window.innerWidth < 768 ? 12 : 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            align: 'center',
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 9 : 12
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1,
                            cornerRadius: 6,
                            displayColors: true,
                            titleFont: {
                                size: window.innerWidth < 768 ? 10 : 12
                            },
                            bodyFont: {
                                size: window.innerWidth < 768 ? 9 : 11
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { 
                                display: true, 
                                text: 'X', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 6 : 10
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Error Absoluto', 
                                font: { 
                                    size: window.innerWidth < 768 ? 9 : 14,
                                    weight: 'bold'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 8 : 12
                                },
                                color: '#666',
                                maxTicksLimit: window.innerWidth < 768 ? 5 : 8
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)',
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }

        window.onload = function() {
            calculateFit();
        };
    </script>
</body>
</html>